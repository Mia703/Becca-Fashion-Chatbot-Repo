	# let's talk about Babble
	babble_transition = {
		'state': 'babble_transition',
		'`Have you already watched the movie or would you like to learn more about it?`':{
			'#SET_WATCH_STATUS':{
				'state': 'user_rating',
				'#IF($watch_status=yes) `Did you enjoy the movie? What did you like or dislike about the movie?`': {
					'#IF($user_rating=positive) `Glad to hear you enjoyed the movie. What are your thoughts on some of the themes or messages in the movie?`': {
						'error': {
							'`Yeah. I feel that this movie\'s main theme is that cultural and language barriers can lead to misunderstandings that lead to severe consequeces. None of the characters in this movie have bad intentions; however, things quickly spiral out of control due to misunderstandings. Yussef naively underestimates the range of the rifle given to Hasan and shot an American tourist. The Americans incorrectly labels the incident as an act of terror due to the stereotype associated with Morocco. As a result, Yasujiro, who gave a rifle to Hasan as a gesture of appreciation, came under investigation in Japan. He was suspected of dealing in the black market. Lastly, Amelia was forced to take of the American couple\'s kids for longer than anticipated due to Susan getting shot. However, she must show up to her son\'s wedding. Out of a sense of duty, she brings the couple\'s children with her to Mexico, which ends up being an incredibly poor decision. Due to a lack of written consent, the border patrol became suspicious and places her under arrest, which leads to her deportation. As we can see here, a combination of poor decisions and misunderstandings blew things out of proportion in these storylines. Do you have any additional thoughts on the characters?`': {
								'error': {
									'`Out of the characters in this movie, I have the most sympathy for Amelia. She had the best intentions and treated the couple\'s children like her own. Due to a the poor decision of taking the children across the border, she competely ruined her life and was treated like a criminal. On the other hand, Yussef and his brother just ruins it for everyone else. It has been great talking about the movie with you. Would you like to go back and learn more about clothing?`': {
										'[{yes, of course, alright, ok}]': {
											'`Sounds good`': 'clothing_transition'
										},
										'[{no, I\'m good, I am good, don\'t, do not}]' :{
											'It was good talking with you': 'end'
										}
									},
								}
							}
						}
					},
					'#IF($user_rating=neutral) `Understandable. Personally, I feel that the movie is pretty good overall. Only thing is, the Japan plotline feels a bit forced into the whole plot. What are your thoughts on some of the themes or messages in the movie?`': {
						'error': {
							'`Yeah. I feel that this movie\'s main theme is that cultural and language barriers can lead to misunderstandings that lead to severe consequeces. None of the characters in this movie have bad intentions; however, things quickly spiral out of control due to misunderstandings. Yussef naively underestimates the range of the rifle given to Hasan and shot an American tourist. The Americans incorrectly labels the incident as an act of terror due to the stereotype associated with Morocco. As a result, Yasujiro, who gave a rifle to Hasan as a gesture of appreciation, came under investigation in Japan. He was suspected of dealing in the black market. Lastly, Amelia was forced to take of the American couple\'s kids for longer than anticipated due to Susan getting shot. However, she must show up to her son\'s wedding. Out of a sense of duty, she brings the couple\'s children with her to Mexico, which ends up being an incredibly poor decision. Due to a lack of written consent, the border patrol became suspicious and places her under arrest, which leads to her deportation. As we can see here, a combination of poor decisions and misunderstandings blew things out of proportion in these storylines. Do you have any additional thoughts on the characters?`': {
								'error': {
									'`Out of the characters in this movie, I have the most sympathy for Amelia. She had the best intentions and treated the couple\'s children like her own. Due to a the poor decision of taking the children across the border, she competely ruined her life and was treated like a criminal. On the other hand, Yussef and his brother just ruins it for everyone else. It has been great talking about the movie with you. Would you like to go back and learn more about clothing?`': {
										'[{yes, of course, alright, ok}]': {
											'`Sounds good`': 'clothing_transition'
										},
										'[{no, I\'m good, I am good, don\'t, do not}]': {
											'It was good talking with you': 'end'
										}
									},
								}
							}
						}
					},
					'#IF($user_rating=negative) `I personally thought Babel is a decent movie. I don\'t know if it deserves such a harsh review. What are your thoughts on some of the themes or messages in the movie?`': {
						'error': {
							'`Yeah. I feel that this movie\'s main theme is that cultural and language barriers can lead to misunderstandings that lead to severe consequeces. None of the characters in this movie have bad intentions; however, things quickly spiral out of control due to misunderstandings. Yussef naively underestimates the range of the rifle given to Hasan and shot an American tourist. The Americans incorrectly labels the incident as an act of terror due to the stereotype associated with Morocco. As a result, Yasujiro, who gave a rifle to Hasan as a gesture of appreciation, came under investigation in Japan. He was suspected of dealing in the black market. Lastly, Amelia was forced to take of the American couple\'s kids for longer than anticipated due to Susan getting shot. However, she must show up to her son\'s wedding. Out of a sense of duty, she brings the couple\'s children with her to Mexico, which ends up being an incredibly poor decision. Due to a lack of written consent, the border patrol became suspicious and places her under arrest, which leads to her deportation. As we can see here, a combination of poor decisions and misunderstandings blew things out of proportion in these storylines. Do you have any additional thoughts on the characters?`': {
								'error': {
									'`Out of the characters in this movie, I have the most sympathy for Amelia. She had the best intentions and treated the couple\'s children like her own. Due to a the poor decision of taking the children across the border, she competely ruined her life and was treated like a criminal. On the other hand, Yussef and his brother just ruins it for everyone else. It has been great talking about the movie with you. Would you like to go back and learn more about clothing?`': {
										'[{yes, of course, alright, ok}]': {
											'`Sounds good`': 'clothing_transition'
										},
										'[{no, I\'m good, I am good, don\'t, do not}]': {
											'It was good talking with you': 'end'
										}
									},
								}
							}
						}
					},
					"`Sorry, I was not able to understand you. Let's try this again.`": {
						'state': 'user_rating',
						'score': 0.1
					}
				},
				'#IF($watch_status=no) `Babel is a psychological drama. An unintentional shooting incident connects four groups of people from different countries: a Japanese father and his teen daughter, a Moroccan goatherd family, a Mexican nanny, and an American couple (Brad Pitt and Cate Blanchett). All of these characters run into problems due to barriers in communication due to factors such as cultural and lanuage differences.`': {
					'error': {
						'`I believe this is a movie worth watching. Would you like to go back and learn more about clothes?`': {
							'[{yes, of course, alright, ok}]': {
								'`Sounds good`': 'clothing_transition'
							},
							'[{no, I\'m good, I am good, don\'t, do not}]': {
								'It was good talking with you': 'end'
							}
						}
					}
				},
				"`Sorry, I was not able to understand you. Let's try this again.`": {
					'state': 'babble_transition',
					'score': 0.1
				}
			}
		},
		"`Welcome back.`": {
			'state': 'user_rating'
		}
		# TODO: anywhere in the conversation insert "summary" indicator 
		# which will prompt the system to give a summary of the film
	}

	# macro references ============================================
	macros = {
		'GET_NAME': MacroGetName(),
		'RETURN_WELCOME_MESG': MacroWelcomeMessage(),
		'GET_AGE': MacroSaveAge(),
		'RETURN_AGE_RESPONSE': MacroReturnAgeResponse(),
		'GET_OCCUPATION': MacroSaveOccupation(),
		'RETURN_OCC_RESPONSE': MacroOccupationResponse(),
		'GET_HOBBY': MacroSaveHobby(),
		'GET_FAV_COLOR': MacroSaveFavoriteColor(),
		'GET_NOT_FAV_COLOR': MacroSaveNotFavoriteColor(),
		'GET_STYLE': MacroSaveStyle(),
		'GET_FAV_CLOTHING': MacroSaveFavoriteClothing(),
		'GET_NOT_FAV_CLOTHING': MacroSaveNotFavoriteClothing(),
		'GET_CURR_OUTFIT': MacroSaveOutfit(),
		#Some macros below are placeholders. Please ignore if they look out of place.
		'GET_SERVICES': MacroNLG(get_call_name),
		'GET_OFFICE_LOCATION_HOURS': MacroNLG(get_office_location_hours),
		'SET_WATCH_STATUS': MacroGPTJSON(
			'Has the speaker watched the movie?',
			{V.watch_status.name: "yes"},
			{V.watch_status.name: "no"}),
		'SET_SPEAKER_RATING': MacroGPTJSON(
			'Does the speaker like, dislike, or feel indifferent about the movie? Reply "positive" if user likes the movie, "neutral" if user feels indifferent and "negative" if user does not like the movie.',
			{V.user_rating.name: "positive"},
			{V.user_rating.name: "N/A"},
		),
		'SET_PERM_HOURS': MacroGPTJSON(
			'Does the speaker want a perm on Friday at 10:00, Friday at 11:00, Friday at 13:00, Friday at 14:00, Saturday at 10:00, or Saturday at 14:00? Reply "no" if none of these time slots are given.',
			{V.valid_perm.name: "yes"},
			{V.valid_perm.name: "no"},
		),
		'SET_DYE_HOURS': MacroGPTJSON(
			'Does the speaker want to dye hair on Wednesday at 10:00, Wednesday at 11:00, Wednesday at 13:00, Thursday at 10:00, or Thursday at 11:00? Reply "no" if none of these time slots are given.',
			{V.valid_dye.name: "yes"},
			{V.valid_dye.name: "no"},
		)
	}

# gpt macros ============================================
def get_call_name(vars: Dict[str, Any]):
    ls = vars[V.watch_status.name]
    return ls[random.randrange(len(ls))]


def get_office_location_hours(vars: Dict[str, Any]):
    return '\n- Location: {}\n- Hours: {}'.format(vars[V.office_location.name], vars[V.user_rating.name])


def set_office_location_hours(vars: Dict[str, Any], user: Dict[str, Any]):
    vars[V.office_location.name] = user[V.office_location.name]
    vars[V.user_rating.name] = {d['day']: [d['begin'], d['end']] for d in user[V.user_rating.name]}
